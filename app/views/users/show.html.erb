<main>
	<div class="row">
		<div class="col-md-1"></div>
		<!-- PROFILE SIDEBAR -->
		<div class="col-md-3">
			<!-- USER AVATAR, NAME & LOCATION -->
			<div id="profile-pic-box">
				<header>
				<img src="<%= @user.avatar %>" alt="profile-picture">
					<h1><%= @user.full_name %></h1>
					<p><%= @user.city_state %></p>
				</header>
			</div>
			<!-- ======= END USER NAME & LOCATION ========= -->
		</div>
		<!-- MAIN CONTENT -->
		<div class="col-md-6">
			<!-- BOOTSTRAP TOGGEABLE TABS -->
			<nav>
				<ul class="nav nav-tabs" role="tablist">
					<!-- SKILLS TAB -->
			    <li role="presentation" class="active">
			    	<a href="#skills" aria-controls="skills" role="tab" data-toggle="tab">Skills</a>
		    	</li>
					<!-- REQUESTS TAB -->
  		 <!--  	<% "if current_user && user_id == @user.id" %>
				    <li role="presentation">
				    	<a href="#requests" aria-controls="requests" role="tab" data-toggle="tab">Requests</a>
			    	</li>
		    	<% "end" %> -->
		    	<!-- REVIEWS TAB -->
			    <li role="presentation">
			    	<a href="#reviews" aria-controls="reviews" role="tab" data-toggle="tab">Reviews</a>
		    	</li>
		    	<!-- ABOUT ME TAB -->
			    <li role="presentation">
		    	<a href="#about-me" aria-controls="About-me" role="tab" data-toggle="tab">About me</a></li>
	  		</ul>
			</nav>
			<!-- ========== END BOOTSTRAP TOGGEABLE TABS ========== -->

			<!-- TABS CONTENT -->
		  <div class="tab-content">
		    <!-- SKILLS TAB CONTENT -->
		    <div role="tabpanel" class="tab-pane fade in active" id="skills">
		    	<!-- COLLAPSIBLE GROUP OF SKILLS -->
					<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
			    	<% @user.collections.each do |collection| %>
					  <div class="panel panel-default">
		    			<!-- THE SKILL NAME FOR THIS COLLECTION
		    					 IS CLICKABLE AND EXPANDS TO REVEAL THE SKILL DETAILS -->
					    <div class="panel-heading" role="tab" id="collection-<%= collection.id %>">
								<a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse_collection-<%= collection.id %>" aria-expanded="true" aria-controls="collapse_collection-<%= collection.id %>">
					    		<h4 class="panel-title">
											<%= collection.skill.name %> <em>(click to show or hide details)</em>
					    		</h4>
				        </a>
			    		</div>
			    		<!-- ========== END SKILL NAME ================ -->

			    		<!-- THIS CONTENT IS DISPLAYED WHEN THE SKILL NAME IS CLICKED -->
		    		  <div id="collapse_collection-<%= collection.id %>" class="panel-collapse collapse" role="tabpanel" aria-labelledby="collection-<%= collection.id %>">
					      <div class="panel-body">
					      	<% @collection = collection %>
					      	<%= render 'collections/details', locals: { collection: @collection }  %>
      		    		<br>
      		    		<br>
      		    		<% if current_user && user_id != @user.id  %>
										<a href="#" class="new-request-link">Request a lesson!</a>

									<div style="display: block;">
					 					<%= form_for @request, as: :request, url: user_skill_requests_path(@user, collection.skill_id), method: "post" do |f| %>
									    <%= f.label :content, "Write a message" %><br>
									    <%= f.text_field :content %>
									    <%= f.submit %>
										<% end %>
							    </div>
							    <% end %>
					      </div>
					    </div>
			    		<!-- ========== END SKILL CONTENT DISPLAY ================ -->
						</div>
    				<% end %>
					</div>
    			<!-- ========== END COLLAPSIBLE GROUP LOOP ================ -->
		    </div>
  			<!-- ========== END SKILLS TAB CONTENT ================ -->

		    <!-- REQUESTS TAB CONTENT -->
		  	<% if current_user && user_id == @user.id %>
			    <div role="tabpanel" class="tab-pane fade" id="requests">
						<div id="sent-requets">
				    	<h2>Sent requests</h2>
							<% if @user.sent_requests != nil %>
					    	<% @user.sent_requests.each do |r| %>
					    	<div class="request boxes">
					    		<% if r.accepted == nil %>
					    			<p class="btn btn-primary">Pending</p>
									<% elsif r.accepted == false %>
					    			<p class="btn btn-danger">Denied</p>
									<% else %>
					    			<p class="btn btn-success">Accepted</p>
					    		<% end %>
					    		<p>You want to learn <%= r.skill.name %> from <%= r.receiver.full_name %>.</p>
					    		<p>Sent <%= time_ago_in_words(r.created_at) %> ago</p>
					    		<%= link_to "Manage this request and chat with #{r.receiver.first_name}", request_path(r) %>
				    		</div>
					    	<% end %>
				    	<% else %>
				    		<p>You have yet to make any requests.</p>
			    		<% end %>
			    	</div>
			    	<h2>Received requests</h2>
						<% if @user.sent_requests != nil %>
				    	<% @user.received_requests.each do |r| %>
				    		<div class="request boxes">
					    		<p><%= r.sender.full_name %> wants to learn <%= r.skill.name %> from you!</p>
					    		<p>Sent <%= time_ago_in_words(r.created_at) %> ago</p>
					    		<%= button_to "Accept", request_path(r), method: "patch", class:"btn btn-success" %>
					    		<br>
					    		<%= button_to "Decline", edit_request_path(r), method: "patch", class:"btn btn-danger" %>
					    		<%= link_to "Manage this request and chat with #{r.sender.first_name}", request_path(r) %>
				    		</div>
			    		<% end %>
				    <% else %>
			    		<p>You have yet to make any requests.</p>
			    	<% end %>
			    </div>
		    <% end %>
	  		<!-- ========== END REQUESTS TAB CONTENT ================ -->

		    <!-- REVIEWS TAB CONTENT-->
		    <div role="tabpanel" class="tab-pane fade" id="reviews">
		     <%if @user != current_user && accepted_requests?(@user) %>
		    	<%=link_to "Create review", new_user_review_path(@user) %>
		     <% end %>
			     <%@user.received_reviews.each do |review| %>
				     <p><%=review.content %></p>
				     <p><%=review.sender.first_name %></p>
				     <p><%=time_ago_in_words(review.created_at) %></p>
				     <img src="<%=review.sender.avatar %>">
				     <hr>
		     	<% end %>
		    </div>
	  		<!-- ========== END REIVEWS TAB CONTENT ================ -->

		    <!-- ABOUT ME TAB CONTENT -->
		    <div role="tabpanel" class="tab-pane fade" id="about-me">
		    	<br>
		    	<div class="boxes">
		    		<p>Occupation: <%= @user.occupation %></p>
						<p>Education: <%= @user.education.capitalize %></p>
		    		<p>Bio: <%= @user.description %></p>
		    	</div>
		    </div>
	  		<!-- ========== END ABOUT ME TAB CONTENT ================ -->
		  </div>
		</div>
		<div class="col-md-1"></div>
	</div>
</main>